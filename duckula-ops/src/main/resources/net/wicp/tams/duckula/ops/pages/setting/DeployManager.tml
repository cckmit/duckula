<html xmlns:t="http://tapestry.apache.org/schema/tapestry_5_4.xsd"
      xmlns:r="tapestry-library:rjzjh"
      xmlns:s="tapestry-library:tams"
      xmlns:p="tapestry:parameter"> 
<head>
   <title isMenu="true" module="3">发布管理</title>
</head>
<body>
   <r:query id="q"  qBlock="query" queryUrl="/setting/DeployManager:query"  uBlock="save"   saveUrl="/setting/DeployManager:save" deleteUrl="/setting/DeployManager:del" opFormatter="showopt" 
        columns="[[{field:'name',width:200,title:'发布名'},{field:'deploy',width:100,title:'发布类型'},{field:'env',width:100,title:'环境'},{field:'isInit',width:50,title:'是否初始化'},{field:'op',width:320,title:'操作'}]]" 
        dialogStyle="width:800px;height:460px;" initAddHandle="initAdd" initSaveHandle="initUpdate"  pagination="false"/>
   <t:block id="query">
       <table class="frame_table_list_4">
		 <tr>
			    <td class="frame_table_list_4_righttext">发布名</td>
				<td>
				   <r:validatebox name="name"/>
				</td>
				<td class="frame_table_list_4_righttext" colspan="6">
				  <font color="red">
				   <div align="left">1、需要初始化 </div>
				   </font>
				</td>
		 </tr>
	  </table>
   </t:block>
   <t:block id="save">
        <table class="frame_table_list_2">
			      <tr>
			 	  	 <td class="frame_table_list_2_righttext">发布名</td>
			 	     <td>
			 	       <r:validatebox name="name" style="width:250px;" required="true"/>
			 	     </td>
			 	      <td class="frame_table_list_2_righttext">发布类型</td>
			         <td>
			            <r:comboboxenum id="deploy_save"  name="deploy" enumClass="net.wicp.tams.app.duckula.controller.config.constant.DeployType" required="true"></r:comboboxenum>
			          </td>
			      </tr>
			      <tr>			      
			      <td class="frame_table_list_2_righttext">环境</td>
			         <td>
			            <r:validatebox name="env" style="width:250px;" required="true"/>
			            <input type="hidden" name="id"/>
	                 </td>			        
			 	  	 <td class="frame_table_list_2_righttext">锁IP</td>
			 	     <td>
			 	       <r:comboboxenum id="isInit_save"  name="isInit" enumClass="net.wicp.tams.common.constant.dic.YesOrNo" required="true"></r:comboboxenum>
			 	     </td>
			 	     
			      </tr>
			      
	 </table>
   </t:block>

 
   
<script>	
    function showopt(value,row,index){
            var optCan=false;//row.taskNum=='0'?false:true;
            var initCan=row.isInit=='yes'?false:true;
       	    var update= '<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-edit"  data-options="disabled:'+optCan+'"  style="margin-right:10px" onclick="_doUpdate('+index+') ">'+msg.update+'</a>';
       	    var deletebut= '<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-remove" data-options="disabled:'+optCan+'" style="margin-right:10px" onclick="_doDelete('+index+') ">'+msg.delete_+'</a>'; 
       	    var initbut='<a href="javascript:void(0)" class="easyui-linkbutton" iconCls="icon-role" data-options="disabled:false" style="margin-right:10px" onclick="initServer(\''+index+'\') ">初始化</a>';
			return update+deletebut+initbut;
     }

   function initAdd(){
      //$('#os_save').combobox('setValue','Linux');
   }
   function initUpdate(){
      //$('#ip2').textbox('readonly',true);
   }

   
   function initServer(index){
       var row=getRow(index);
       $.rjzjh.prompt('请输入此服务器的root密码？',function(pwd){
           pwd=pwd.replace(/^\s+|\s+$/g,"");
           if(gt(pwd.length,0)){
               row.pwd=pwd;
               $.messager.progress({
			    	title:window.msg.hintwaiting,
			    	msg:window.msg.hinthandling
	            }); 
               $.post($.rjzjh.packurl('/setting/DeployManager:initServer'),row,function(data){
                 $.messager.progress('close');
	             $.rjzjh.opt2(data,function(){
	                $.rjzjh.alert("初始化成功");
				    jQuery('#q_grid').datagrid('reload');
		         }); 
		       },'json');
           }
		});
   }
   

     
   function getRow(index){
     	 var rows = jQuery('#q_grid').datagrid('getRows');
     	 return rows[index];
   }
   
  $(function(){

   });
   
    
</script>
</body>
</html>